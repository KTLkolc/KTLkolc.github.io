<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>纸上谈兵 - 战场沙盘</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #f0f0f0;
            overflow: hidden;
            user-select: none;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
        }
        
        #battlefield {
            position: absolute;
            width: 2000px;
            height: 2000px;
            background: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab598d?q=80&w=2000') center/cover;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid #ffd166;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        
        .player {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ff7e5f;
            border: 3px solid white;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            transform: translate(-50%, -50%);
            transition: left 0.3s, top 0.3s;
            z-index: 10;
        }
        
        .player::after {
            content: attr(data-name);
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        #my-player {
            background-color: #4a6fa5;
            border-color: #ffd166;
            z-index: 20;
        }
        
        #controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: grid;
            grid-template-columns: repeat(3, 50px);
            grid-template-rows: repeat(3, 50px);
            gap: 5px;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            border: 2px solid #ffd166;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
        
        #move-up {
            grid-column: 2;
            grid-row: 1;
        }
        
        #move-left {
            grid-column: 1;
            grid-row: 2;
        }
        
        #move-right {
            grid-column: 3;
            grid-row: 2;
        }
        
        #move-down {
            grid-column: 2;
            grid-row: 3;
        }
        
        #chat-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 300px;
            height: 200px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        #chat-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            color: white;
        }
        
        #chat-input {
            display: flex;
            padding: 10px;
            background: rgba(0,0,0,0.5);
        }
        
        #chat-input input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            margin-right: 5px;
        }
        
        #chat-input button {
            padding: 8px 15px;
            background: #ff7e5f;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
        
        .message {
            margin-bottom: 5px;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        
        .message .sender {
            color: #ffd166;
            font-weight: bold;
        }
        
        #game-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            display: flex;
            justify-content: space-between;
            z-index: 100;
        }
        
        #zoom-controls {
            position: fixed;
            top: 60px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            border: 2px solid #ffd166;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        #mini-map {
            position: fixed;
            top: 60px;
            left: 20px;
            width: 150px;
            height: 150px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ffd166;
        }
        
        #mini-map-viewport {
            position: absolute;
            border: 2px dashed #ff7e5f;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-header">
            <div id="game-title">纸上谈兵 - 战场沙盘</div>
            <div id="game-stats">
                <span id="online-count">1</span>人在线 | 
                位置: <span id="position">800,800</span> | 
                区域: <span id="zone">中央</span>
            </div>
        </div>
        
        <div id="battlefield"></div>
        
        <div id="controls">
            <div class="control-btn" id="move-up">↑</div>
            <div class="control-btn" id="move-left">←</div>
            <div class="control-btn" id="move-right">→</div>
            <div class="control-btn" id="move-down">↓</div>
        </div>
        
        <div id="chat-container">
            <div id="chat-messages">
                <div class="message">
                    <span class="sender">系统:</span> 欢迎来到战场沙盘！
                </div>
            </div>
            <div id="chat-input">
                <input type="text" id="chat-text" placeholder="输入聊天内容...">
                <button id="send-btn">发送</button>
            </div>
        </div>
        
        <div id="zoom-controls">
            <div class="zoom-btn" id="zoom-in">+</div>
            <div class="zoom-btn" id="zoom-out">-</div>
        </div>
        
        <div id="mini-map">
            <div id="mini-map-viewport"></div>
        </div>
    </div>

    <script>
        // 游戏状态
        const gameState = {
            myPlayer: null,
            otherPlayers: {},
            battlefield: document.getElementById('battlefield'),
            zoomLevel: 1,
            offsetX: 0,
            offsetY: 0
        };
        
        // 初始化游戏
        function initGame() {
            // 创建自己的玩家
            const playerName = prompt('请输入你的将军名号:', '将军' + Math.floor(Math.random() * 100));
            if (!playerName) return;
            
            gameState.myPlayer = {
                id: 'player-' + Math.random().toString(36).substr(2, 9),
                name: playerName,
                x: 1000,
                y: 1000,
                color: getRandomColor()
            };
            
            createPlayer(gameState.myPlayer, true);
            
            // 模拟其他玩家 (实际应用中应从服务器获取)
            simulateOtherPlayers();
            
            // 设置控制
            setupControls();
            
            // 设置聊天
            setupChat();
            
            // 更新位置显示
            updatePositionDisplay();
            
            // 初始化小地图
            updateMiniMap();
        }
        
        // 创建玩家
        function createPlayer(player, isMe = false) {
            const playerElement = document.createElement('div');
            playerElement.className = 'player';
            playerElement.id = isMe ? 'my-player' : 'player-' + player.id;
            playerElement.style.left = player.x + 'px';
            playerElement.style.top = player.y + 'px';
            playerElement.style.backgroundColor = player.color;
            playerElement.setAttribute('data-name', player.name);
            playerElement.textContent = player.name.charAt(0);
            
            gameState.battlefield.appendChild(playerElement);
            return playerElement;
        }
        
        // 模拟其他玩家
        function simulateOtherPlayers() {
            const names = ['赵云', '关羽', '张飞', '吕布', '曹操', '孙权', '周瑜', '诸葛亮'];
            const colors = ['#ff3e3e', '#3eff3e', '#3e3eff', '#ffff3e', '#ff3eff'];
            
            for (let i = 0; i < 10; i++) {
                const player = {
                    id: 'npc-' + i,
                    name: names[i % names.length] + (i > names.length ? Math.floor(i / names.length) : ''),
                    x: Math.random() * 1800 + 100,
                    y: Math.random() * 1800 + 100,
                    color: colors[i % colors.length]
                };
                
                gameState.otherPlayers[player.id] = player;
                createPlayer(player);
            }
            
            // 模拟NPC移动
            setInterval(() => {
                for (const id in gameState.otherPlayers) {
                    const player = gameState.otherPlayers[id];
                    const dx = (Math.random() - 0.5) * 20;
                    const dy = (Math.random() - 0.5) * 20;
                    
                    player.x = Math.max(100, Math.min(1900, player.x + dx));
                    player.y = Math.max(100, Math.min(1900, player.y + dy));
                    
                    const playerElement = document.getElementById('player-' + player.id);
                    if (playerElement) {
                        playerElement.style.left = player.x + 'px';
                        playerElement.style.top = player.y + 'px';
                    }
                }
            }, 100);
        }
        
        // 设置控制
        function setupControls() {
            const speed = 20;
            
            document.getElementById('move-up').addEventListener('click', () => movePlayer(0, -speed));
            document.getElementById('move-down').addEventListener('click', () => movePlayer(0, speed));
            document.getElementById('move-left').addEventListener('click', () => movePlayer(-speed, 0));
            document.getElementById('move-right').addEventListener('click', () => movePlayer(speed, 0));
            
            // 键盘控制
            document.addEventListener('keydown', (e) => {
                let dx = 0, dy = 0;
                
                switch(e.key) {
                    case 'ArrowUp': case 'w': case 'W': dy = -speed; break;
                    case 'ArrowDown': case 's': case 'S': dy = speed; break;
                    case 'ArrowLeft': case 'a': case 'A': dx = -speed; break;
                    case 'ArrowRight': case 'd': case 'D': dx = speed; break;
                }
                
                if (dx !== 0 || dy !== 0) {
                    movePlayer(dx, dy);
                }
            });
            
            // 缩放控制
            document.getElementById('zoom-in').addEventListener('click', () => zoom(0.1));
            document.getElementById('zoom-out').addEventListener('click', () => zoom(-0.1));
        }
        
        // 移动玩家
        function movePlayer(dx, dy) {
            if (!gameState.myPlayer) return;
            
            gameState.myPlayer.x = Math.max(100, Math.min(1900, gameState.myPlayer.x + dx));
            gameState.myPlayer.y = Math.max(100, Math.min(1900, gameState.myPlayer.y + dy));
            
            const playerElement = document.getElementById('my-player');
            if (playerElement) {
                playerElement.style.left = gameState.myPlayer.x + 'px';
                playerElement.style.top = gameState.myPlayer.y + 'px';
            }
            
            updatePositionDisplay();
            updateMiniMap();
            centerViewport();
        }
        
        // 更新位置显示
        function updatePositionDisplay() {
            if (!gameState.myPlayer) return;
            
            document.getElementById('position').textContent = 
                Math.floor(gameState.myPlayer.x) + ',' + Math.floor(gameState.myPlayer.y);
            
            // 确定区域
            let zone = '中央';
            if (gameState.myPlayer.x < 800 && gameState.myPlayer.y < 800) zone = '西北';
            else if (gameState.myPlayer.x >= 1200 && gameState.myPlayer.y < 800) zone = '东北';
            else if (gameState.myPlayer.x < 800 && gameState.myPlayer.y >= 1200) zone = '西南';
            else if (gameState.myPlayer.x >= 1200 && gameState.myPlayer.y >= 1200) zone = '东南';
            
            document.getElementById('zone').textContent = zone;
        }
        
        // 设置聊天
        function setupChat() {
            const chatInput = document.getElementById('chat-text');
            const chatMessages = document.getElementById('chat-messages');
            
            document.getElementById('send-btn').addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // 模拟接收消息
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const names = Object.values(gameState.otherPlayers).map(p => p.name);
                    const name = names[Math.floor(Math.random() * names.length)];
                    addMessage(name, getRandomMessage());
                }
            }, 3000);
        }
        
        function sendMessage() {
            const chatInput = document.getElementById('chat-text');
            const message = chatInput.value.trim();
            
            if (message && gameState.myPlayer) {
                addMessage(gameState.myPlayer.name, message);
                chatInput.value = '';
            }
        }
        
        function addMessage(sender, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.innerHTML = `<span class="sender">${sender}:</span> ${message}`;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function getRandomMessage() {
            const messages = [
                "全军出击！",
                "发现敌军！",
                "请求支援！",
                "我军大捷！",
                "粮草充足，继续前进！",
                "敌人在东北方向！",
                "布阵防守！",
                "骑兵准备冲锋！",
                "弓箭手就位！",
                "谋士有何良策？"
            ];
            return messages[Math.floor(Math.random() * messages.length)];
        }
        
        // 缩放控制
        function zoom(delta) {
            gameState.zoomLevel = Math.max(0.5, Math.min(2, gameState.zoomLevel + delta));
            gameState.battlefield.style.transform = 
                `translate(-50%, -50%) scale(${gameState.zoomLevel})`;
            updateMiniMap();
        }
        
        // 更新小地图
        function updateMiniMap() {
            if (!gameState.myPlayer) return;
            
            const viewport = document.getElementById('mini-map-viewport');
            const scale = 150 / 2000; // 小地图缩放比例
            
            viewport.style.width = (window.innerWidth * scale / gameState.zoomLevel) + 'px';
            viewport.style.height = (window.innerHeight * scale / gameState.zoomLevel) + 'px';
            viewport.style.left = (gameState.myPlayer.x * scale - parseInt(viewport.style.width) / 2) + 'px';
            viewport.style.top = (gameState.myPlayer.y * scale - parseInt(viewport.style.height) / 2) + 'px';
        }
        
        // 居中视口
        function centerViewport() {
            if (!gameState.myPlayer) return;
            
            const container = document.getElementById('game-container');
            const rect = container.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            
            const targetX = -gameState.myPlayer.x * gameState.zoomLevel + centerX;
            const targetY = -gameState.myPlayer.y * gameState.zoomLevel + centerY;
            
            gameState.battlefield.style.left = '50%';
            gameState.battlefield.style.top = '50%';
            gameState.battlefield.style.marginLeft = targetX + 'px';
            gameState.battlefield.style.marginTop = targetY + 'px';
        }
        
        // 随机颜色
        function getRandomColor() {
            return `hsl(${Math.random() * 360}, 70%, 60%)`;
        }
        
        // 启动游戏
        window.onload = initGame;
    </script>
</body>
</html>
